{% extends "backend/list_layout.html" %}
{% block partial_thead_tr %}
    <th data-field="sortable" class="sorting-mode text-center srot-filed" style="width: 100px;">排序</th>
    {% for property in scaffolding.display_in_list -%}
        <th data-field="{{ property }}" class="text-center">{{ s.scaffold_field_name(property) }}</th>
    {% endfor -%}
    <th data-field="op" class="sorting-mode text-center srot-filed">權限</th>
{% endblock %}

{# 權限 #}
{% macro check_permission_url(action, item) -%}
    {% if action == "view" %}{% if uri_exists_with_permission(action="view", item=item) %}data-view-url="{{ uri_action_link('view', item) }}"{% endif %}{% endif %}
    {% if action == "edit" %}{% if uri_exists_with_permission(action='edit', item=item) and application_user_level >= item.level %}data-edit-url="{{ uri_action_link('edit', item) }}"{% endif %}{% endif %}
    {% if action == "delete" %}{% if uri_exists_with_permission(action='delete', item=item) and application_user_level > item.level and application_user_key != item.key %}data-delete-url="{{ uri_action_link('delete', item) }}"{% endif %}{% endif %}
{%- endmacro %}

{% block partial_tr_item %}
{%- set list = context[scaffolding.plural] -%}
{% for item in list %}
    {% if item.level < 1000 or (application_user_level > 1000 and item.level > 1000) -%}
    <tr id="node_{{ item.sort }}" class="record_item"
        {{ check_permission_url("view", item) }}
        {{ check_permission_url("edit", item) }}
        {{ check_permission_url("delete", item) }}
        data-id="{{ print_key(item) }}">
        <td class="text-center sorting-mode move-headline">
            {% if uri_exists_with_permission(action="sort_up", item=item) %}<a href="{{ uri_action_link('sort_up', item) }}" class="btn-json"><i class="icon icon-2x">keyboard_arrow_up</i></a>{% endif %}
            <i class="icon icon-2x">view_headline</i>
            {% if uri_exists_with_permission(action="sort_down", item=item) %}<a href="{{ uri_action_link('sort_down', item) }}" class="btn-json"><i class="icon icon-2x">keyboard_arrow_down</i></a>{% endif %}
        </td>
        {% for property in scaffolding.display_in_list -%}
        <td>{%- if property.find("is_") >= 0 %}
            <div class="checkbox checkbox-success">
                <input type="checkbox" {% if item[property] %}checked{% endif %} id="{{ print_key(item) }}"
                       class="btn-checkbox-json">
                <label for="{{ print_key(item) }}">{{ s.scaffold_field_name("short_" + property) }}</label>
            </div>
            {% else -%}{{ print_value(item[property]) }}{%- endif -%}
        </td>
        {% endfor -%}
        <td class="text-right print-hide">
            {% if uri_exists_with_permission(action='action_permissions', item=item) and application_user_level >= item.level %}<a href="{{ uri_action_link('action_permissions', item) }}" class="btn btn-white btn-sm"><i class="fa fa-shield"></i> 權限 </a>{% endif %}
        </td>
    </tr>
    {%- endif %}
{% endfor -%}
{% endblock %}

{% block layout_buttons %}
    {%- if scaffolding %}
        {% if uri_exists_with_permission(action="add") -%}
            <a href="{{ uri_action_link('add') }}" class="fbtn fbtn-lg fbtn-brand-accent waves-attach waves-circle waves-light"><span class="fbtn-text fbtn-text-left">{{ s.scaffold_title("add") }}</span><span class="icon icon-lg">edit</span></a>
        {%- endif -%}
    {%- endif %}
{% endblock %}